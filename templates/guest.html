<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Ellora AI</title>
    <link rel="icon" href="\assests\elloraicon.svg" type="image/x-icon">
    <link rel="icon" href="\assests\elloraicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: #0a0a0a;
            color: #ffffff;
        }
        
        .perplexity-bg {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }
        
        .search-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .message-user {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
        }
        
        .message-assistant {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
        }
        
        .code-block {
            background: #1e293b;
            border: 1px solid #374151;
            border-radius: 8px;
            margin: 12px 0;
            overflow: hidden;
        }
        
        .code-header {
            background: #0f172a;
            padding: 8px 16px;
            border-bottom: 1px solid #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #94a3b8;
        }
        
        .copy-btn {
            background: #374151;
            border: none;
            color: #e5e7eb;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: #4b5563;
        }
        
        .copy-btn.copied {
            background: #10b981;
        }
        
        .sidebar {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .personality-badge {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #a78bfa;
        }

       
        
        .typing-dots span {
            background: #10b981;
            border-radius: 50%;
            width: 4px;
            height: 4px;
            margin: 0 2px;
            display: inline-block;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .source-card {
            background: rgba(75, 85, 99, 0.2);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        .settings-modal {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .input-field:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="min-h-screen">

    <button id="openSidebarBtn" class="fixed top-4 left-4 z-50 bg-blue-600 text-white rounded-full p-3 shadow-lg "                 style="display:none;">
        <i class="fas fa-bars"></i>
    </button>
    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 w-72 h-full sidebar transform -translate-x-full transition-transform duration-300 z-50">
        <div class="p-6">
            <!-- Logo -->
            <div class="flex items-center mb-8">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-green-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-robot text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold gradient-text">Ellora AI</h1>
            </div>

        <button id="closeSidebarBtn" class="absolute top-4 right-4 text-gray-400 hover:text-white " title="Hide sidebar">
            <i class="fas fa-times text-2xl"></i>
        </button>
            
            <!-- New Chat Button -->
            <button id="new-chat" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg mb-6 transition-colors duration-200">
                <i class="fas fa-plus mr-2"></i>New Chat
            </button>
            
            <!-- Personality Selection -->
            <div class="mb-6">
                <h3 class="text-sm font-medium text-gray-400 mb-3">Personality</h3>
                <div class="personality-badge text-sm px-3 py-2 rounded-lg mb-3" id="current-personality">
                    üòä Friendly
                </div>
                <button id="change-personality" class="text-sm text-blue-400 hover:text-blue-300 transition-colors">
                    Change personality
                </button>
            </div>
            
            <!-- Features -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-300">Voice Replies</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="voice-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                
                <button id="upload-file" class="flex items-center text-sm text-gray-300 hover:text-white transition-colors w-full text-left">
                    <i class="fas fa-paperclip mr-3"></i>Upload File
                </button>
                
                <button id="settings-btn" class="flex items-center text-sm text-gray-300 hover:text-white transition-colors w-full text-left">
                    <i class="fas fa-cog mr-3"></i>Settings
                </button>

               <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg mb-6 transition-colors duration-200 " id="login-btn" onclick="window.location.href='/auth'">Sign in / Sign up</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="lg:ml-72 min-h-screen flex flex-col">
        <!-- Mobile Header -->
        <div class="lg:hidden bg-black border-b border-gray-800 p-4">
            <button id="mobile-menu" class="text-white">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- Chat Area -->
        <div class="flex-1 flex flex-col max-w-4xl mx-auto w-full">
            <!-- Messages Container -->
            <div id="messages" class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Welcome Message -->
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-robot text-white text-2xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-3 gradient-text">Welcome to Ellora AI</h2>
                    <p class="text-gray-400 text-lg mb-8">Multi-personality AI assistant created by Abhishek Sharma</p>
                    
                    <!-- Sample Questions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                        <button class="sample-question p-4 text-left bg-gray-800/50 hover:bg-gray-800 rounded-lg border border-gray-700 transition-all duration-200" data-question="What is artificial intelligence?">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-brain text-blue-400 mr-2"></i>
                                <span class="font-medium">What is AI?</span>
                            </div>
                            <p class="text-sm text-gray-400">Learn about artificial intelligence</p>
                        </button>
                        
                        <button class="sample-question p-4 text-left bg-gray-800/50 hover:bg-gray-800 rounded-lg border border-gray-700 transition-all duration-200" data-question="Write a Python function to calculate fibonacci numbers">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-code text-green-400 mr-2"></i>
                                <span class="font-medium">Code Help</span>
                            </div>
                            <p class="text-sm text-gray-400">Get programming assistance</p>
                        </button>
                        
                        <button class="sample-question p-4 text-left bg-gray-800/50 hover:bg-gray-800 rounded-lg border border-gray-700 transition-all duration-200" data-question="Tell me a funny joke">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-smile text-yellow-400 mr-2"></i>
                                <span class="font-medium">Entertainment</span>
                            </div>
                            <p class="text-sm text-gray-400">Have some fun conversations</p>
                        </button>
                        
                        <button class="sample-question p-4 text-left bg-gray-800/50 hover:bg-gray-800 rounded-lg border border-gray-700 transition-all duration-200" data-question="Explain quantum computing in simple terms">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-atom text-purple-400 mr-2"></i>
                                <span class="font-medium">Learn</span>
                            </div>
                            <p class="text-sm text-gray-400">Explore complex topics</p>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="border-t border-gray-800 p-6">
                <div class="search-container rounded-2xl p-4">
                    <div class="flex items-center space-x-4">
                        <button id="voice-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-microphone text-xl"></i>
                        </button>
                        
                        <input 
                            type="text" 
                            id="message-input" 
                            placeholder="Ask me anything..." 
                            class="flex-1 bg-transparent outline-none text-white placeholder-gray-400"
                            autocomplete="off"
                        >
                        
                        <button id="attach-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-paperclip text-xl"></i>
                        </button>
                        
                        <button id="send-btn" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-xl transition-colors">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-3 text-center">Ellora AI can make mistakes. Consider checking important information.</p>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 settings-modal hidden items-center justify-center z-50">
        <div class="modal-content rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold">Settings</h3>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- Personality Selection -->
                <div>
                    <label class="block text-sm font-medium mb-3">Select Personality</label>
                    <select id="personality-select" class="w-full input-field rounded-lg px-4 py-3">
                        <option value="Friendly üòä">üòä Friendly</option>
                        <option value="Sarcastic ü•±">ü•± Sarcastic</option>
                        <option value="Professional üßë‚Äçüíº">üßë‚Äçüíº Professional</option>
                        <option value="Love Poet ü•∞">ü•∞ Love Poet</option>
                        <option value="Vedic Vyasa üïâÔ∏è">üïâÔ∏è Vedic Vyasa</option>
                        <option value="Medic Expert ‚öïÔ∏è">‚öïÔ∏è Medic Expert</option>
                    </select>
                </div>
                
                <!-- Clear Chat -->
                <button id="clear-chat" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors">
                    <i class="fas fa-trash mr-2"></i>Clear All Conversations
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden File Input -->
    <input type="file" id="file-input" class="hidden" accept=".txt,.md,.py,.jpg,.png,.jpeg">
    
    <script>
        class ElloraAI {
            constructor() {
                this.apiBase = window.location.origin;
                this.sessionId = this.generateSessionId();
                this.currentPersonality = 'Friendly üòä';
                this.isRecording = false;
                this.mediaRecorder = null;
                this.recordedChunks = [];
                
                this.initElements();
                this.bindEvents();
            }
            
            generateSessionId() {
                return 'session_' + Math.random().toString(36).substr(2, 9);
            }
            
            initElements() {
                this.elements = {
                    sidebar: document.getElementById('sidebar'),
                    mobileMenu: document.getElementById('mobile-menu'),
                    newChat: document.getElementById('new-chat'),
                    messages: document.getElementById('messages'),
                    messageInput: document.getElementById('message-input'),
                    sendBtn: document.getElementById('send-btn'),
                    voiceBtn: document.getElementById('voice-btn'),
                    attachBtn: document.getElementById('attach-btn'),
                    fileInput: document.getElementById('file-input'),
                    settingsBtn: document.getElementById('settings-btn'),
                    settingsModal: document.getElementById('settings-modal'),
                    closeModal: document.getElementById('close-modal'),
                    personalitySelect: document.getElementById('personality-select'),
                    currentPersonality: document.getElementById('current-personality'),
                    changePersonality: document.getElementById('change-personality'),
                    voiceToggle: document.getElementById('voice-toggle'),
                    clearChat: document.getElementById('clear-chat'),
                    uploadFile: document.getElementById('upload-file')
                };
            }
            
            bindEvents() {
                // Mobile menu
                this.elements.mobileMenu?.addEventListener('click', () => {
                    this.elements.sidebar.classList.toggle('-translate-x-full');
                });
                
                // New chat
                this.elements.newChat.addEventListener('click', () => this.startNewChat());
                
                // Send message
                this.elements.sendBtn.addEventListener('click', () => this.sendMessage());
                this.elements.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                // Voice input
                this.elements.voiceBtn.addEventListener('click', () => this.toggleVoiceRecording());
                
                // File upload
                this.elements.attachBtn.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.uploadFile.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
                
                // Settings
                this.elements.settingsBtn.addEventListener('click', () => this.openSettings());
                this.elements.changePersonality.addEventListener('click', () => this.openSettings());
                this.elements.closeModal.addEventListener('click', () => this.closeSettings());
                this.elements.personalitySelect.addEventListener('change', () => this.changePersonality());
                
                // Clear chat
                this.elements.clearChat.addEventListener('click', () => this.clearAllChats());
                
                // Sample questions
                document.querySelectorAll('.sample-question').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const question = btn.dataset.question;
                        this.elements.messageInput.value = question;
                        this.sendMessage();
                    });
                });
                
                // Close modal on outside click
                this.elements.settingsModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.settingsModal) this.closeSettings();
                });
            }
            
            async sendMessage() {
                const message = this.elements.messageInput.value.trim();
                if (!message) return;
                
                this.addMessage(message, true);
                this.elements.messageInput.value = '';
                this.hideWelcome();
                this.showTyping();
                
                try {
                    const response = await fetch(`${this.apiBase}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            message: message,
                            role: this.currentPersonality,
                            session_id: this.sessionId
                        })
                    });
                    
                    const data = await response.json();
                    this.hideTyping();
                    this.addMessage(data.response, false, data.sources);
                    
                    // Voice reply if enabled
                    if (this.elements.voiceToggle.checked) {
                        this.playTextToSpeech(data.response);
                    }
                    
                } catch (error) {
                    this.hideTyping();
                    this.addMessage('Sorry, I encountered an error. Please try again.', false);
                    console.error('Error:', error);
                }
            }
            
            addMessage(content, isUser, sources = []) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `${isUser ? 'message-user' : 'message-assistant'} p-6 rounded-xl`;
                
                if (isUser) {
                    messageDiv.innerHTML = `
                        <div class="flex items-start space-x-4">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="prose prose-invert max-w-none">
                                    ${this.escapeHtml(content)}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const processedContent = this.processMarkdown(content);
                    let sourcesHtml = '';
                    
                    if (sources && sources.length > 0) {
                        sourcesHtml = `
                            <div class="mt-4">
                                <h4 class="text-sm font-medium text-gray-400 mb-2">Sources</h4>
                                <div class="space-y-2">
                                    ${sources.map((source, index) => `
                                        <div class="source-card">
                                            <div class="text-sm">
                                                <strong>Source ${index + 1}:</strong> ${source.content}
                                            </div>
                                            <div class="text-xs text-gray-500 mt-1">${source.reference || 'Reference'}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                    
                    messageDiv.innerHTML = `
                        <div class="flex items-start space-x-4">
                            <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-robot text-white text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="prose prose-invert max-w-none">
                                    ${processedContent}
                                </div>
                                ${sourcesHtml}
                            </div>
                        </div>
                    `;
                }
                
                this.elements.messages.appendChild(messageDiv);
                
                // Highlight code blocks
                Prism.highlightAllUnder(messageDiv);
                
                this.scrollToBottom();
            }
            
            processMarkdown(content) {
                // Configure marked
                marked.setOptions({
                    highlight: function(code, lang) {
                        if (Prism.languages[lang]) {
                            return Prism.highlight(code, Prism.languages[lang], lang);
                        }
                        return code;
                    },
                    breaks: true,
                    gfm: true
                });
                
                let processedContent = marked.parse(content);
                
                // Add copy buttons to code blocks
                processedContent = processedContent.replace(
                    /<pre><code class="language-(\w+)">([\s\S]*?)<\/code><\/pre>/g,
                    (match, lang, code) => {
                        const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                        return `
                            <div class="code-block">
                                <div class="code-header">
                                    <span>${lang.toUpperCase()}</span>
                                    <button class="copy-btn" onclick="copyCode('${codeId}')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <pre><code id="${codeId}" class="language-${lang}">${code}</code></pre>
                            </div>
                        `;
                    }
                );
                
                // Handle code blocks without language
                processedContent = processedContent.replace(
                    /<pre><code>([\s\S]*?)<\/code><\/pre>/g,
                    (match, code) => {
                        const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                        return `
                            <div class="code-block">
                                <div class="code-header">
                                    <span>CODE</span>
                                    <button class="copy-btn" onclick="copyCode('${codeId}')">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <pre><code id="${codeId}">${code}</code></pre>
                            </div>
                        `;
                    }
                );
                
                return processedContent;
            }
            
            showTyping() {
                const typingDiv = document.createElement('div');
                typingDiv.id = 'typing-indicator';
                typingDiv.className = 'message-assistant p-6 rounded-xl';
                typingDiv.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                this.elements.messages.appendChild(typingDiv);
                this.scrollToBottom();
            }
            
            hideTyping() {
                const typing = document.getElementById('typing-indicator');
                if (typing) typing.remove();
            }
            
            hideWelcome() {
                const welcome = this.elements.messages.querySelector('.text-center');
                if (welcome) welcome.style.display = 'none';
            }
            
            scrollToBottom() {
                this.elements.messages.scrollTop = this.elements.messages.scrollHeight;
            }
            
            escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            openSettings() {
                this.elements.settingsModal.classList.remove('hidden');
                this.elements.settingsModal.classList.add('flex');
            }
            
            closeSettings() {
                this.elements.settingsModal.classList.add('hidden');
                this.elements.settingsModal.classList.remove('flex');
            }
            
            changePersonality() {
                this.currentPersonality = this.elements.personalitySelect.value;
                this.elements.currentPersonality.textContent = this.currentPersonality;
                this.closeSettings();
            }
            
            async startNewChat() {
                this.sessionId = this.generateSessionId();
                this.elements.messages.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-robot text-white text-2xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold mb-3 gradient-text">Welcome to Ellora AI</h2>
                        <p class="text-gray-400 text-lg mb-8">Multi-personality AI assistant created by Abhishek Sharma</p>
                    </div>
                `;
            }
            
            async clearAllChats() {
                if (confirm('Are you sure you want to clear all conversations?')) {
                    await fetch(`${this.apiBase}/api/clear-session`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: this.sessionId })
                    });
                    this.startNewChat();
                    this.closeSettings();
                }
            }
            
            async toggleVoiceRecording() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    alert("Voice recording not supported in this browser.");
                    return;
                }
                
                if (!this.isRecording) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.mediaRecorder = new MediaRecorder(stream);
                        this.recordedChunks = [];
                        
                        this.mediaRecorder.ondataavailable = (event) => {
                            if (event.data.size > 0) {
                                this.recordedChunks.push(event.data);
                            }
                        };
                        
                        this.mediaRecorder.onstop = () => {
                            const blob = new Blob(this.recordedChunks, { type: 'audio/wav' });
                            // For now, just show a message. You can implement speech-to-text here
                            alert('Voice recording complete! (Speech-to-text integration needed)');
                            stream.getTracks().forEach(track => track.stop());
                        };
                        
                        this.mediaRecorder.start();
                        this.isRecording = true;
                        this.elements.voiceBtn.innerHTML = '<i class="fas fa-stop text-red-500"></i>';
                        
                    } catch (error) {
                        console.error('Error accessing microphone:', error);
                        alert('Error accessing microphone. Please check permissions.');
                    }
                } else {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.elements.voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                }
            }
            
            async handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                // For now, just show file name. You can implement file processing here
                alert(`File selected: ${file.name} (File processing integration needed)`);
            }
            
            async playTextToSpeech(text) {
                try {
                    const response = await fetch(`${this.apiBase}/api/text-to-speech`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: text })
                    });
                    
                    const data = await response.json();
                    if (data.audio) {
                        const audio = new Audio(`data:audio/mp3;base64,${data.audio}`);
                        audio.play();
                    }
                } catch (error) {
                    console.error('Text-to-speech error:', error);
                }
            }
        }
        
        // Global copy function for code blocks
        window.copyCode = function(codeId) {
            const codeElement = document.getElementById(codeId);
            const button = codeElement.parentNode.parentNode.querySelector('.copy-btn');
            
            if (codeElement) {
                const code = codeElement.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    const originalContent = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.innerHTML = originalContent;
                        button.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy:', err);
                });
            }
        };

        document.addEventListener('DOMContentLoaded', function() {

            // initialize the app

                new ElloraAI()

            //sdiebar functionality
                const sidebar   = document.getElementById('sidebar');
                const closeBtn  = document.getElementById('closeSidebarBtn');
                const openBtn   = document.getElementById('openSidebarBtn');

                // Helper: Hide sidebar (mobile)
                function hideSidebar() {
                    sidebar.classList.add('-translate-x-full');
                    openBtn.style.display = 'block';
                }
                // Helper: Show sidebar (mobile)
                function showSidebar() {
                    sidebar.classList.remove('-translate-x-full');
                    openBtn.style.display = 'none';
                }

                closeBtn?.addEventListener('click', hideSidebar);
                openBtn?.addEventListener('click', showSidebar);

                // Optional: Hide sidebar by default on mobile when page loads
                if (window.innerWidth <= 1024) {
                    hideSidebar();
                }

                if (window.innerWidth > 1024) {
                    showSidebar();
                } else {
                    hideSidebar();
                }


                // Optional: Hide sidebar when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    // Only on mobile, and only if sidebar is open and click is outside
                    if(window.innerWidth <= 1024 && !sidebar.classList.contains('-translate-x-full')) {
                        if (!sidebar.contains(e.target) && !openBtn.contains(e.target)) {
                            hideSidebar();
                        }
                    }
                });

            // Optional: Auto-hide/sidebar on resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 1024) {
                        showSidebar();
                    } else {
                        hideSidebar();
                    }
                });
            });

        
             
    </script>
</body>
</html>
